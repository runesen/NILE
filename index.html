<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribution generalization with linear extrapolation within IV setting • NILE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Distribution generalization with linear extrapolation within IV setting">
<meta property="og:description" content="NILE is an estimator applicable in a nonlinear
    instrumental variables (IV) setting and achieves distribution generalization
    with linear extensions. For further details refer to the paper The difficult 
    task of distribution generalization in nonlinear models by Christiansen et al.
    (2020) &lt;arXiv:2006.07433&gt;. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">NILE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/vgn_reproduce_results.html">Reproduce paper results</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/runesen/NILE/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="nile" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#nile" class="anchor"></a>NILE</h1></div>
<!-- badges: start -->

<p>The <code>NILE</code> estimator can be used to estimate a nonlinear causal influence of a single predictor <em>X</em> on a real-valued response <em>Y</em>. It exploits an instrumental variable (IV) setting with a single exogenous variable <em>A</em> which serves as instrument. Predictions obtained from the NILE estimator are causal predictions in the sense that they predict the values of <em>Y</em> under interventions which break the dependence between <em>X</em> and possible confounders of (<em>X</em>, <em>Y</em>). For further details refer to the paper Christiansen et al. (2020 <a href="https://arxiv.org/abs/2006.07433" class="external-link uri">https://arxiv.org/abs/2006.07433</a>).</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<!-- You can install the released version of NILE from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("NILE") -->
<!-- ``` -->
<p>You can install the the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"runesen/NILE"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>This is a basic example which shows the idea behind NILE. Let us start by importing the <code>NILE</code> library.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runesen/NILE" class="external-link">NILE</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></code></pre></div>
<p>Suppose that the true (unknown) functional relationship between <em>X</em> and <em>Y</em> is defined by a spline that linearly extrapolates outside the training data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># true (unknown) functional relationship X -&gt; Y</span>
<span class="co"># (linearly extrapolating beyond "extrap")</span>
<span class="va">fX</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">extrap</span>, <span class="va">beta</span><span class="op">)</span><span class="op">{</span>
  <span class="va">bx</span> <span class="op">&lt;-</span> <span class="fu">splines</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">x</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">extrap</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, to<span class="op">=</span><span class="va">extrap</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
                                   length.out<span class="op">=</span><span class="op">(</span><span class="va">n.splines.true</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>
                                     <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">n.splines.true</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,
                    Boundary.knots <span class="op">=</span> <span class="va">extrap</span><span class="op">)</span>
  <span class="va">bx</span><span class="op">%*%</span><span class="va">beta</span>
<span class="op">}</span></code></pre></div>
<p>Let us define the data generating model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data generating model</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">n.splines.true</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">beta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n.splines.true</span>, <span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">alphaA</span> <span class="op">&lt;-</span> <span class="va">alphaEps</span> <span class="op">&lt;-</span> <span class="va">alphaH</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">alphaA</span><span class="op">*</span><span class="va">A</span> <span class="op">+</span> <span class="va">alphaH</span><span class="op">*</span><span class="va">H</span> <span class="op">+</span> <span class="va">alphaEps</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">fX</span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>,extrap<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.7</span>,<span class="fl">.7</span><span class="op">)</span>, beta<span class="op">=</span><span class="va">beta0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.3</span><span class="op">*</span><span class="va">H</span> <span class="op">+</span> <span class="fl">.2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>

<span class="va">x.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>,length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span>
<span class="va">f.new</span> <span class="op">&lt;-</span> <span class="fu">fX</span><span class="op">(</span>x<span class="op">=</span><span class="va">x.new</span>,extrap<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.7</span>,<span class="fl">.7</span><span class="op">)</span>, beta<span class="op">=</span><span class="va">beta0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x.new</span>,<span class="va">f.new</span>,col<span class="op">=</span><span class="st">"#0072B2"</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<p>Given the observed dataset, let us now fit NILE.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/NILE.html">NILE</a></span><span class="op">(</span><span class="va">Y</span>, <span class="co"># response</span>
            <span class="va">X</span>, <span class="co"># predictors (so far, only 1-dim supported)</span>
            <span class="va">A</span>, <span class="co"># anchors (1 or 2-dim, although 2-dim is experimental so far)</span>
            lambda.star <span class="op">=</span> <span class="st">"test"</span>, <span class="co"># (0 = OLS, Inf = IV, (0,Inf) =</span>
            <span class="co"># nonlinear anchor regression, "test" = NILE)</span>
            test <span class="op">=</span> <span class="st">"tsls.over.ols"</span>,
            intercept <span class="op">=</span> <span class="cn">TRUE</span>,
            df <span class="op">=</span> <span class="fl">50</span>, <span class="co"># number of splines used for X -&gt; Y</span>
            p.min <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># level at which test for lambda is performed</span>
            x.new <span class="op">=</span> <span class="va">x.new</span>, <span class="co"># values at which predictions are required</span>
            plot<span class="op">=</span><span class="cn">TRUE</span>, <span class="co"># diagnostics plots</span>
            f.true <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fX</span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.7</span>,<span class="fl">.7</span><span class="op">)</span>, <span class="va">beta0</span><span class="op">)</span>, <span class="co"># if supplied, the</span>
            <span class="co"># true causal function is added to the plot</span>
            par.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda<span class="op">=</span><span class="cn">NULL</span>, <span class="co"># positive smoothness penalty for X -&gt; Y,</span>
                         <span class="co"># if NULL, it is chosen by CV to minimize out-of-sample</span>
                         <span class="co"># AR objective</span>
                         breaks<span class="op">=</span><span class="cn">NULL</span>, <span class="co"># if breaks are supplied, exactly these</span>
                         <span class="co"># will be used for splines basis</span>
                         num.breaks<span class="op">=</span><span class="fl">20</span>, <span class="co"># will result in num.breaks+2 splines,</span>
                         <span class="co"># ignored if breaks is supplied.</span>
                         n.order<span class="op">=</span><span class="fl">4</span> <span class="co"># order of splines</span>
                         <span class="op">)</span>,
            par.a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda<span class="op">=</span><span class="cn">NULL</span>, <span class="co"># positive smoothness penalty for fit of</span>
                         <span class="co"># residuals onto A. If NULL, we first compute the OLS</span>
                         <span class="co"># fit of Y onto X,</span>
                                      <span class="co"># and then choose lambdaA by CV to</span>
                         <span class="co"># minimize the out-of-sample MSE for predicting</span>
                         <span class="co"># the OLS residuals</span>
                         breaks<span class="op">=</span><span class="cn">NULL</span>, <span class="co"># same as above</span>
                         num.breaks<span class="op">=</span><span class="fl">4</span>, <span class="co"># same as above</span>
                         n.order<span class="op">=</span><span class="fl">4</span> <span class="co"># same as above</span>
                         <span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "lambda.cv.a =  1.42932324587573"</span>
<span class="co">#&gt; [1] "lambda.cv.x =  0.0015933292003293"</span>
<span class="co">#&gt; [1] "lambda.star.p.uncorr =  1.45538091659546"</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Christiansen, R., Pfister, N., Jakobsen, M. E., Gnecco, N., &amp; Peters, J. (2020). <em>The difficult task of distribution generalization in nonlinear models</em>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/runesen/NILE/">https://​github.com/​runesen/​NILE/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/runesen/NILE/issues">https://​github.com/​runesen/​NILE/​issues</a>
</li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>


<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rune Christiansen <br><small class="roles"> Author, maintainer </small>  </li>
<li>Niklas Pfister <br><small class="roles"> Author </small>  </li>
<li>Martin Emil Jakobsen <br><small class="roles"> Author </small>  </li>
<li>Nicola Gnecco <br><small class="roles"> Author </small>  </li>
<li>Jonas Peters <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#maturing" class="external-link"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="lifecycle"></a></li>
<li><a href="https://travis-ci.org/runesen/NILE" class="external-link"><img src="https://travis-ci.org/runesen/NILE.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/runesen/NILE?branch=master" class="external-link"><img src="https://codecov.io/gh/runesen/NILE/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/runesen/NILE/actions" class="external-link"><img src="https://github.com/runesen/NILE/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Rune Christiansen, Niklas Pfister, Martin Emil Jakobsen, Nicola Gnecco, Jonas Peters.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
